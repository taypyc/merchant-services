$(".loader-wrap").addClass("loader-active"),window.addEventListener("dragover",e=>e.preventDefault(),!1),window.addEventListener("drop",e=>e.preventDefault(),!1),document.addEventListener("DOMContentLoaded",()=>{let m={inputButtonFileText:"File",inputButtonSizeText:"Size",inputButtonAnotherFileText:"Upload another file",filetypeWarnMessage:"Please select image or PDF file",filesizeWarnMessage:"Max size is 6Mb",fileNoticeMessage:"JPG,PNG,PDF smaller than 6Mb",fileNoticeMessageUploaded:"File was uploaded",fileuploadSuccessMessage:"Success",fileuploadErrorMessage:"Error with uploading file",fileChoose:"Add File Here",fileLoading:"Loading..."},g=function(e,t=window.location.href){let n=new RegExp("[?&]"+e.replace(/[\[\]]/g,"\\$&")+"(=([^&#]*)|&|#|$)"),l=n.exec(t);return l?l[2]?decodeURIComponent(l[2].replace(/\+/g," ")):"":null}("id"),l=document.getElementById("files-group"),h=[];function y(n){return new Promise(function(e,t){$.ajax(n).done(e).fail(t)})}function v(e){return["image/jpeg","image/png","application/pdf"].includes(e)}function w(e){return parseInt(e,10)<5242880}function x(e,t=null,n=null,l=null){let i=e.querySelector(".icon-line-1"),s=e.querySelector(".icon-line-2"),a=e.querySelector(".icon-line-3");i&&s&&a&&(i.textContent=null!==t?t:i.textContent,s.textContent=null!==t?n:s.textContent,a.textContent=null!==t?l:a.textContent)}function b(e){try{var t=JSON.parse(e);if(t&&"object"==typeof t)return t}catch(e){}return!1}g&&y({url:"php/get-files.php",type:"post",data:{id:g}}).then(function(t,e){let p=b(t.d)||{};if(p.status&&"success"==p.status&&p.id&&p.id==g&&p.files&&Array.isArray(p.files)){p.files.forEach(e=>{e.name&&e.id&&(e=function(r,d="",c=""){let u=document.getElementById("input-template");if(u){let e=u.content.cloneNode(!0),t=e.querySelector("input"),n=e.querySelector("label"),l=e.querySelector("figcaption"),i=l.querySelector(".icon-line-1"),s=l.querySelector(".icon-line-2"),a=l.querySelector(".icon-line-3");t.name=t.name+c,t.id=t.id+c,t.dataset.name=d,t.dataset.id=c,n.setAttribute("for",t.name),i.textContent=m.fileChoose,s.textContent="",a.textContent=m.fileNoticeMessage;let o=e.querySelector(".slide-head");return o.textContent=d,r.appendChild(e)}}(l,e.name,e.id),$(e).hide().fadeIn(400))}),$(".loader-wrap").removeClass("loader-active"),$(".slide-head").bind("click",function(e){e&&e.preventDefault&&e.preventDefault();let t=$(this),n=t.parent().find(".slide-body");t.parent().hasClass("slide-minimized")?n.slideDown({duration:300,complete:()=>{t.parent().removeClass("slide-minimized")}}):n.slideUp({duration:300,complete:()=>{t.parent().addClass("slide-minimized")}})});var n=document.querySelectorAll(".fileinput");Array.prototype.forEach.call(n,a=>{let o=a.nextElementSibling,r=a.parentElement,d=r.parentElement.parentElement,c=d.querySelector(".slide-head")||null,u=o.querySelector("figure")||null,f=o.querySelector("figcaption")||null;r.ondrop=function(t){if(t.preventDefault(),t.stopPropagation(),!r.classList.contains("filebox-success")){a.files=t.dataTransfer.files;let e=new DataTransfer;e.items.add(t.dataTransfer.files[0]),a.files=e.files,a.dispatchEvent(new Event("change"))}},r.ondragover=r.ondragenter=e=>{r.classList.add("has-focus")},r.ondragleave=r.onmouseleave=e=>{r.classList.remove("has-focus")},a.addEventListener("change",e=>{var t,n,l=document.getElementById("base-icon").content.cloneNode(!0);let i=document.getElementById("success-icon").content.cloneNode(!0),s=document.getElementById("error-icon").content.cloneNode(!0);if(0<a.files.length)if(w(a.files[0].size)&&v(a.files[0].type)){a.disabled=!0,x(f,m.inputButtonFileText+": "+a.files[0].name,m.inputButtonSizeText+": "+(t=parseInt(a.files[0].size,10),n=Math.floor(Math.log(t)/Math.log(1024)),+(t/Math.pow(1024,n)).toFixed(2)+" "+["B","kB","MB","GB","TB"][n]),m.fileLoading),u.querySelector("svg").replaceWith(l),r.className="filebox filebox-progress";let e=new FormData;e.append("file",a.files[0]),e.append("id",g),e.append("doc_id",a.dataset.id),e.append("doc_name",a.dataset.name),y({url:"php/form-file.php",type:"post",data:e,cache:!1,contentType:!1,processData:!1}).then(function(e){var t=b(e.d)||{};if("success"!=e.response||"success"!=t.status)throw a.value=null,new Error("Response data error");u.querySelector("svg").replaceWith(i),x(f,m.fileuploadSuccessMessage,"",m.fileNoticeMessageUploaded),r.className="filebox filebox-success",d&&(d.classList.add("slide-success"),d.classList.contains("slide-minimized")||c.click()),(!a.dataset.success||a.dataset.success&&1!=a.dataset.success)&&(a.dataset.success=1,h.push({})),a.disabled=!0,a.classList.add("fileinput-disabled"),r.classList.add("filebox-disabled"),o.setAttribute("for",a.name+"-disabled"),h.length==p.files.length&&t.redirect_link&&(window.location.href=t.redirect_link)}).catch(function(e){a.disabled=!1,u.querySelector("svg").replaceWith(s),x(f,m.fileuploadErrorMessage,"",m.fileNoticeMessage),r.className="filebox filebox-error",d&&(d.classList.remove("slide-success"),d.classList.contains("slide-minimized")&&c.click()),console.log("Request failed: %o",e)})}else a.dataset.success&&1==a.dataset.success?a.disabled=!0:v(a.files[0].type)?w(a.files[0].size)||x(f,m.filesizeWarnMessage,null,null):x(f,m.filetypeWarnMessage,null,null),a.value=null;else a.dataset.success&&1==a.dataset.success&&(a.disabled=!0),x(f,m.fileChoose+" "+a.dataset.name,null,null)})})}else{if("error"!=p.status||"no_requested_files"!=p.description||!p.redirect_link){let e=new Error("Get files error");throw e.redirect=t.r,e.data=p,e}window.location.href=p.redirect_link}}).catch(function(e){console.error("Request failed: %s",e),e&&e.data&&e.data.redirect_link?window.location.href=e.data.redirect_link:e&&0<e.redirect.length&&(window.location.href=e.redirect)})});